[build]
  command = "npm run build"
  publish = "dist"
  edge_functions = "netlify/edge-functions"

[build.environment]
  NODE_VERSION = "20"
  # Vite exposes VITE_* vars to browser bundles by design.
  # Supabase URL + anon key are public client values (RLS must protect data).
  # DATABASE_URL and DIRECT_DATABASE_URL are for Umami backend deployments and must stay server-side.
  SECRETS_SCAN_OMIT_KEYS = "VITE_GOOGLE_MAPS_API_KEY,VITE_GEMINI_API_KEY,GEMINI_API_KEY,OPENAI_API_KEY,ANTHROPIC_API_KEY,OPENROUTER_API_KEY,TF_ADMIN_API_KEY,VITE_SUPABASE_URL,VITE_SUPABASE_ANON_KEY,VITE_UMAMI_SCRIPT_URL,VITE_UMAMI_WEBSITE_ID,DATABASE_URL,DIRECT_DATABASE_URL"

[dev]
  targetPort = 5173

[[edge_functions]]
  path = "/api/health"
  function = "health"

[[edge_functions]]
  path = "/api/trip-map-preview"
  function = "trip-map-preview"

[[edge_functions]]
  path = "/api/og/trip"
  function = "trip-og-image"

[[edge_functions]]
  path = "/api/og/playground"
  function = "trip-og-playground"

[[edge_functions]]
  path = "/api/og/site"
  function = "site-og-image"

[[edge_functions]]
  path = "/s/*"
  function = "trip-og-meta"

[[edge_functions]]
  path = "/trip/*"
  function = "trip-og-meta"

[[edge_functions]]
  path = "/"
  function = "site-og-meta"

[[edge_functions]]
  path = "/create-trip"
  function = "site-og-meta"

[[edge_functions]]
  path = "/features"
  function = "site-og-meta"

[[edge_functions]]
  path = "/updates"
  function = "site-og-meta"

[[edge_functions]]
  path = "/blog"
  function = "site-og-meta"

[[edge_functions]]
  path = "/login"
  function = "site-og-meta"

[[edge_functions]]
  path = "/imprint"
  function = "site-og-meta"

[[edge_functions]]
  path = "/privacy"
  function = "site-og-meta"

[[edge_functions]]
  path = "/terms"
  function = "site-og-meta"

[[edge_functions]]
  path = "/cookies"
  function = "site-og-meta"

[[edge_functions]]
  path = "/inspirations"
  function = "site-og-meta"

[[edge_functions]]
  path = "/inspirations/*"
  function = "site-og-meta"

[[edge_functions]]
  path = "/pricing"
  function = "site-og-meta"

[[edge_functions]]
  path = "/blog/*"
  function = "site-og-meta"

[[edge_functions]]
  path = "/admin/*"
  function = "site-og-meta"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "/images/blog/*"
  [headers.values]
    Cache-Control = "public, max-age=3600, s-maxage=604800, stale-while-revalidate=2592000"

[build]
  command = "npm run build"
  publish = "dist"
  edge_functions = "netlify/edge-functions"

[build.environment]
  NODE_VERSION = "20"
  # Vite exposes VITE_* vars to browser bundles by design.
  # Supabase URL + anon key are public client values (RLS must protect data).
  # DATABASE_URL and DIRECT_DATABASE_URL are for Umami backend deployments and must stay server-side.
  SECRETS_SCAN_OMIT_KEYS = "VITE_GOOGLE_MAPS_API_KEY,VITE_GEMINI_API_KEY,GEMINI_API_KEY,OPENAI_API_KEY,ANTHROPIC_API_KEY,OPENROUTER_API_KEY,TF_ADMIN_API_KEY,VITE_SUPABASE_URL,VITE_SUPABASE_ANON_KEY,VITE_UMAMI_SCRIPT_URL,VITE_UMAMI_WEBSITE_ID,DATABASE_URL,DIRECT_DATABASE_URL"

[dev]
  targetPort = 5173

[[edge_functions]]
  path = "/api/health"
  function = "health"

[[edge_functions]]
  path = "/api/ai/generate"
  function = "ai-generate"

[[edge_functions]]
  path = "/api/internal/ai/benchmark"
  function = "ai-benchmark"

[[edge_functions]]
  path = "/api/internal/ai/benchmark/export"
  function = "ai-benchmark"

[[edge_functions]]
  path = "/api/internal/ai/benchmark/cleanup"
  function = "ai-benchmark"

[[edge_functions]]
  path = "/api/internal/ai/benchmark/rating"
  function = "ai-benchmark"

[[edge_functions]]
  path = "/api/internal/ai/benchmark/cancel"
  function = "ai-benchmark"

[[edge_functions]]
  path = "/api/trip-map-preview"
  function = "trip-map-preview"

[[edge_functions]]
  path = "/api/og/trip"
  function = "trip-og-image"

[[edge_functions]]
  path = "/api/og/playground"
  function = "trip-og-playground"

[[edge_functions]]
  path = "/api/og/site"
  function = "site-og-image"

[[edge_functions]]
  path = "/s/*"
  function = "trip-og-meta"

[[edge_functions]]
  path = "/trip/*"
  function = "trip-og-meta"

[[edge_functions]]
  path = "/*"
  function = "site-og-meta"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "/images/blog/*"
  [headers.values]
    Cache-Control = "public, max-age=2592000, s-maxage=31536000, stale-while-revalidate=2592000"

[[headers]]
  for = "/fonts/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
